<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="AUDIT" >

  <resultMap id="AUDIT_RESULT" class="com.mpower.domain.model.Audit" >
    <result property="id" column="AUDIT_ID" jdbcType="BIGINT" />
    <result property="auditType" column="AUDIT_TYPE" jdbcType="VARCHAR" />
    <result property="date" column="DATE" jdbcType="TIMESTAMP" />
    <result property="description" column="DESCRIPTION" jdbcType="VARCHAR" />
    <result property="entityType" column="ENTITY_TYPE" jdbcType="VARCHAR" />
    <result property="objectId" column="OBJECT_ID" jdbcType="BIGINT" />
    <result property="user" column="USER" jdbcType="VARCHAR" />
    <result property="personId" column="PERSON_ID" jdbcType="BIGINT" />
    <result property="siteName" column="SITE_NAME" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="AUDIT_HISTORY_FOR_SITE" resultMap="AUDIT_RESULT" parameterClass="com.mpower.domain.model.Audit" >
    select AUDIT_ID, AUDIT_TYPE, DATE, DESCRIPTION, ENTITY_TYPE, OBJECT_ID, USER, PERSON_ID,
      SITE_NAME
    from AUDIT
    where SITE_NAME = #siteName#
  </select>
  
  <select id="AUDIT_HISTORY_FOR_ENTITY" resultMap="AUDIT_RESULT" parameterClass="com.mpower.domain.model.Audit" >
    select AUDIT_ID, AUDIT_TYPE, DATE, DESCRIPTION, ENTITY_TYPE, OBJECT_ID, USER, PERSON_ID,
      SITE_NAME
    from AUDIT
    where ENTITY_TYPE = #entityType# and OBJECT_ID = #objectId# 
    and SITE_NAME = #siteName#
  </select>
  
  <select id="AUDIT_HISTORY_FOR_PERSON" resultMap="AUDIT_RESULT" parameterClass="com.mpower.domain.model.Audit" >
    select AUDIT_ID, AUDIT_TYPE, DATE, DESCRIPTION, ENTITY_TYPE, OBJECT_ID, USER, PERSON_ID,
      SITE_NAME
    from AUDIT
    where PERSON_ID = #personId#
    and SITE_NAME = #siteName#
  </select>
  
  <insert id="INSERT_AUDIT" parameterClass="com.mpower.domain.model.Audit" >
    insert into AUDIT (AUDIT_ID, AUDIT_TYPE, DATE, DESCRIPTION, ENTITY_TYPE, OBJECT_ID, USER,
      PERSON_ID, SITE_NAME)
    values (#auditId#, #auditType#, #date#, #description#,
      #entityType#, #objectId#, #user#, #personId#,
      #siteName#)
  </insert>
  
</sqlMap>