<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="ENTITY_DEFAULT">

	<!-- ResultMaps -->
	<resultMap id="ENTITY_DEFAULT" class="com.mpower.domain.model.customization.EntityDefault">
		<result property="id" column="ENTITY_DEFAULT_ID" jdbcType="BIGINT" />
		<result property="defaultValue" column="DEFAULT_VALUE" jdbcType="VARCHAR" />
		<result property="entityFieldName" column="ENTITY_FIELD_NAME" jdbcType="VARCHAR" />
		<result property="entityType" column="ENTITY_TYPE" jdbcType="VARCHAR" />
		<result property="siteName" column="SITE_NAME" jdbcType="VARCHAR" />
	</resultMap>
	
	<!-- Selects -->
	<select id="SELECT_BY_ENTITY_TYPE_AND_SITE" resultMap="ENTITY_DEFAULT"	parameterClass="map">
		select ENTITY_DEFAULT_ID, DEFAULT_VALUE, ENTITY_FIELD_NAME,	ENTITY_TYPE, SITE_NAME
		from ENTITY_DEFAULT
		where SITE_NAME = #siteName#
		<isNotNull prepend="AND" property="entityTypes">
			ENTITY_TYPE in 
			<iterate property="entityTypes" conjunction="," open="(" close=")">
				#entityTypes[]#
			</iterate>
		</isNotNull>
	</select>

	<!-- Inserts -->
	<insert id="INSERT_ENTITY_DEFAULT" parameterClass="com.mpower.domain.model.customization.EntityDefault">
		insert into ENTITY_DEFAULT (DEFAULT_VALUE, ENTITY_FIELD_NAME, ENTITY_TYPE, SITE_NAME)
		values (#defaultValue#, #entityFieldName#, #entityType#, #siteName#)
		<selectKey keyProperty="id" resultClass="long">
			SELECT LAST_INSERT_ID() AS value
		</selectKey>
	</insert>


	<update id="UPDATE_ENTITY_DEFAULT" parameterClass="com.mpower.domain.model.customization.EntityDefault">
		update ENTITY_DEFAULT 
		SET 
		DEFAULT_VALUE = #defaultValue#,
		ENTITY_FIELD_NAME = #entityFieldName#,
		ENTITY_TYPE = #entityType#,
		SITE_NAME = #siteName#
		where ENTITY_DEFAULT_ID = #id:BIGINT#
	</update>

</sqlMap>