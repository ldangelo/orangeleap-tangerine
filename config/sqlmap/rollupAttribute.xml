<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="ROLLUP_ATTRIBUTE">

    <resultMap id="ROLLUP_ATTRIBUTE_RESULT" class="com.orangeleap.tangerine.domain.rollup.RollupAttribute">
        <result property="id" column="ROLLUP_ATTRIBUTE_ROLLUP_ATTRIBUTE_ID" />
        <result property="attributeDesc" column="ROLLUP_ATTRIBUTE_ATTRIBUTE_DESC" />
        <result property="groupByType" column="ROLLUP_ATTRIBUTE_GROUP_BY_TYPE" />
        <result property="tableName" column="ROLLUP_ATTRIBUTE_TABLE_NAME" />
        <result property="valueColumnName" column="ROLLUP_ATTRIBUTE_VALUE_COLUMN_NAME" />
        <result property="isValueCustomField" column="ROLLUP_ATTRIBUTE_IS_VALUE_CUSTOM_FIELD" />
        <result property="currencyColumnName" column="ROLLUP_ATTRIBUTE_CURRENCY_COLUMN_NAME" />
        <result property="dateColumnName" column="ROLLUP_ATTRIBUTE_DATE_COLUMN_NAME" />
        <result property="groupByColumnName" column="ROLLUP_ATTRIBUTE_GROUP_BY_COLUMN_NAME" />
        <result property="isGroupByCustomField" column="ROLLUP_ATTRIBUTE_IS_GROUP_BY_CUSTOM_FIELD" />
        <result property="siteName" column="ROLLUP_ATTRIBUTE_SITE_NAME" />
    </resultMap>

    <sql id="ROLLUP_ATTRIBUTE_COLS_FRAGMENT">
        rollup_attribute.ROLLUP_ATTRIBUTE_ID as ROLLUP_ATTRIBUTE_ROLLUP_ATTRIBUTE_ID,
        rollup_attribute.ATTRIBUTE_DESC as ROLLUP_ATTRIBUTE_ATTRIBUTE_DESC,
        rollup_attribute.GROUP_BY_TYPE as ROLLUP_ATTRIBUTE_GROUP_BY_TYPE,
        rollup_attribute.TABLE_NAME as ROLLUP_ATTRIBUTE_TABLE_NAME,
        rollup_attribute.VALUE_COLUMN_NAME as ROLLUP_ATTRIBUTE_VALUE_COLUMN_NAME,
        rollup_attribute.IS_VALUE_CUSTOM_FIELD as ROLLUP_ATTRIBUTE_IS_VALUE_CUSTOM_FIELD,
        rollup_attribute.CURRENCY_COLUMN_NAME as ROLLUP_ATTRIBUTE_CURRENCY_COLUMN_NAME,
        rollup_attribute.DATE_COLUMN_NAME as ROLLUP_ATTRIBUTE_DATE_COLUMN_NAME,
        rollup_attribute.GROUP_BY_COLUMN_NAME as ROLLUP_ATTRIBUTE_GROUP_BY_COLUMN_NAME,
        rollup_attribute.IS_GROUP_BY_CUSTOM_FIELD as ROLLUP_ATTRIBUTE_IS_GROUP_BY_CUSTOM_FIELD,
        rollup_attribute.SITE_NAME as ROLLUP_ATTRIBUTE_SITE_NAME    
    </sql>

    <sql id="SELECT_ROLLUP_ATTRIBUTE_FRAGMENT">
        select 
        <include refid="ROLLUP_ATTRIBUTE_COLS_FRAGMENT"/>
        from ROLLUP_ATTRIBUTE rollup_attribute 
        where rollup_attribute.SITE_NAME = #siteName#
    </sql>

    <select id="SELECT_ALL_ROLLUP_ATTRIBUTES" resultMap="ROLLUP_ATTRIBUTE_RESULT" parameterClass="map" >
        <include refid="SELECT_ROLLUP_ATTRIBUTE_FRAGMENT"/>
    </select>

    <select id="SELECT_ROLLUP_ATTRIBUTE_BY_ID" resultMap="ROLLUP_ATTRIBUTE_RESULT" parameterClass="map" >
        <include refid="SELECT_ROLLUP_ATTRIBUTE_FRAGMENT"/>
        and rollup_attribute.ROLLUP_ATTRIBUTE_ID = #id#
    </select>

    <insert id="INSERT_ROLLUP_ATTRIBUTE" parameterClass="com.orangeleap.tangerine.domain.rollup.RollupAttribute">
        insert into ROLLUP_ATTRIBUTE (
        	ROLLUP_ATTRIBUTE_ID,
        	ATTRIBUTE_DESC,
        	GROUP_BY_TYPE,
        	TABLE_NAME,
        	VALUE_COLUMN_NAME,
        	IS_VALUE_CUSTOM_FIELD,
        	CURRENCY_COLUMN_NAME,
        	DATE_COLUMN_NAME,
        	GROUP_BY_COLUMN_NAME,
        	IS_GROUP_BY_CUSTOM_FIELD,
        	SITE_NAME        )
        values (
        	#id# ,
        	#attributeDesc# ,
        	#groupByType# ,
        	#tableName# ,
        	#valueColumnName# ,
        	#isValueCustomField# ,
        	#currencyColumnName# ,
        	#dateColumnName# ,
        	#groupByColumnName# ,
        	#isGroupByCustomField# ,
        	#siteName#         )
        <selectKey keyProperty="id" resultClass="long">
            SELECT LAST_INSERT_ID() AS value
        </selectKey>
    </insert>

    <update id="UPDATE_ROLLUP_ATTRIBUTE" parameterClass="com.orangeleap.tangerine.domain.rollup.RollupAttribute">
        update ROLLUP_ATTRIBUTE
        SET 
        	ROLLUP_ATTRIBUTE_ID = #id# ,
        	ATTRIBUTE_DESC = #attributeDesc# ,
        	GROUP_BY_TYPE = #groupByType# ,
        	TABLE_NAME = #tableName# ,
        	VALUE_COLUMN_NAME = #valueColumnName# ,
        	IS_VALUE_CUSTOM_FIELD = #isValueCustomField# ,
        	CURRENCY_COLUMN_NAME = #currencyColumnName# ,
        	DATE_COLUMN_NAME = #dateColumnName# ,
        	GROUP_BY_COLUMN_NAME = #groupByColumnName# ,
        	IS_GROUP_BY_CUSTOM_FIELD = #isGroupByCustomField# ,
        	SITE_NAME = #siteName#         
        where ROLLUP_ATTRIBUTE_ID = #id#
    </update>

</sqlMap>

